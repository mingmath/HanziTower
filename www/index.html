<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å­—å¡” Hanzi Tower</title>
    
    <!-- Google H5 Games Ads SDK -->
    <script async
        data-ad-client="ca-pub-4655366880404164"
        data-ad-type="h5-games"
        data-ad-break-test="on"
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
    </script>
    
    <script>
        window.adsbygoogle = window.adsbygoogle || [];
        var adBreak = function(o) {adsbygoogle.push(o);}
        adsbygoogle.push({ sound: 'on', preloadAdBreaks: 'on' });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .custom-icon { width: 24px; height: 24px; object-fit: contain; display: inline-block; vertical-align: middle; }
    </style>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div id="error-console" style="display:none; position:fixed; bottom:0; left:0; background:red; color:white; padding:10px; z-index:9999;"></div>
    <audio id="bg-music" loop></audio>

    <!-- ç‰¹æ•ˆå±¤ (å½©å¸¶) -->
    <div id="confetti-container"></div>

    <!-- é ‚éƒ¨å°èˆª (é€™æ˜¯æ‚¨åŸæœ¬ç¼ºå°‘çš„é—œéµéƒ¨åˆ†) -->
    <div class="top-bar">
        <!-- ç­‰ç´šé¡¯ç¤º -->
        <div class="level-badge" id="level-display">
            <span class="level-icon">ğŸ…</span>
            <div class="level-info">
                <span id="lvl-num">1ç­‰</span>
                <span id="lvl-progress" class="text-xs">0/27</span>
            </div>
        </div>

        <div class="top-actions">
            <button class="icon-btn" id="btn-top-home" title="é¦–é "><span class="text-xl">ğŸ </span></button>
            <button class="icon-btn" id="btn-top-mission" title="æ¯æ—¥ä»»å‹™">
                <span class="text-xl">ğŸ“œ</span>
                <div id="mission-dot" class="red-dot" style="display:none;"></div>
            </button>
            <button class="icon-btn" id="btn-top-notebook" title="ç­†è¨˜">
                <img src="images/note.png" alt="ç­†è¨˜" class="custom-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','ğŸ“–')">
            </button>
            <button class="icon-btn" id="btn-top-shop" title="å•†åŸ">
                <img src="images/shop.png" alt="å•†åŸ" class="custom-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','ğŸ›’')">
            </button>
        </div>
    </div>

    <!-- é¦–é  -->
    <div id="view-home" class="view active" style="justify-content: center;">
        <div class="flex flex-col items-center mb-12">
            <img src="images/logo.png" alt="å­—å¡”" class="w-48 sm:w-48 mb-6 object-contain drop-shadow-md" onerror="this.style.display='none';this.insertAdjacentHTML('afterend','<h1 class=\'text-5xl font-black mb-4\'>å­—å¡”</h1>')">
        </div>
        <div class="flex flex-col gap-5 w-full max-w-xs px-6">
            <button id="btn-start" class="btn-primary text-xl py-4">é–‹å§‹éŠæˆ²</button>
            <button id="btn-daily" class="btn-secondary text-lg">ğŸ“… ç°½åˆ°é ˜è Ÿç‡­</button>
            <button id="btn-notebook" class="btn-secondary text-lg bg-stone-100">ğŸ“– è©èªç­†è¨˜</button>
        </div>
        <p class="absolute bottom-5 text-stone-400 text-xs">Ver 5.1 Celebration Update</p>
    </div>

    <!-- é—œå¡é¸å–® -->
    <div id="view-levels" class="view">
        <div class="w-full max-w-md flex flex-col items-center mb-6">
            <div class="flex justify-between items-center w-full mb-4">
                <button id="btn-back-home" class="text-stone-500 font-bold hover:text-black">â—€ è¿”å›</button>
                <h2 class="text-2xl font-bold text-stone-800 tracking-widest">é¸æ“‡é—œå¡</h2>
                <div style="width: 50px;"></div>
            </div>
            <div class="realm-selector">
                <div id="prev-realm" class="realm-nav-btn" onclick="App.changeRealm(-1)">â—€</div>
                <div class="realm-info"><div class="realm-label">CURRENT REALM</div><div id="realm-title" class="realm-name">ç¬¬ä¸€åœ‹åº¦</div></div>
                <div id="next-realm" class="realm-nav-btn" onclick="App.changeRealm(1)">â–¶</div>
            </div>
        </div>
        <div id="level-list-container" class="level-grid"></div>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="view-game" class="view">
        <div class="game-top-section w-full max-w-2xl flex flex-col items-center flex-grow">
            <div class="w-full flex justify-between items-center mb-2 px-2">
                <div style="width: 30px;"></div>
                <div class="scroll-header">
                    <div class="scroll-stick left"></div>
                    <div class="scroll-content" id="current-level-title">ç¬¬ä¸€é—œ</div>
                    <div class="scroll-stick right"></div>
                </div>
                <div style="width: 30px;"></div>
            </div>
            
            <div id="hint-result-area"></div>
            <div id="answer-grid" class="towers-wrapper"></div>
        </div>
        
        <div class="game-bottom-section w-full max-w-lg">
            <div class="w-full border-t-2 border-stone-300 mb-3"></div>
            <div id="character-pool" class="grid-box"></div>
            <div class="flex gap-4 w-full mt-4 mb-2 px-4">
                <button id="btn-hint-bottom" class="flex-1 bg-amber-500 text-white py-3 rounded font-bold shadow-md flex justify-center items-center gap-2 text-lg active:scale-95 transition-transform">
                    <span>ğŸ’¡</span> æç¤º (<span id="btn-hint-count">0</span>)
                </button>
                <button id="btn-check" class="flex-1 btn-primary text-lg shadow-md">ä¿®ç¯‰å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- ç­†è¨˜æœ¬ -->
    <div id="view-notebook" class="view">
        <div class="w-full max-w-md flex items-center justify-between mb-4">
            <button id="btn-back-note" class="text-stone-500 font-bold">â—€ è¿”å›</button>
            <h2 class="text-xl font-bold text-stone-800 tracking-widest">ä¿®ç¯‰ç­†è¨˜</h2>
            <div></div>
        </div>
        <div id="notebook-list" class="w-full max-w-md flex flex-col gap-3 pb-10"></div>
    </div>

    <!-- é€šç”¨ Modals -->
    <div id="modal" class="modal-mask"><div id="modal-content" class="modal-body"><div id="modal-icon" class="text-5xl mb-4 text-stone-700">ğŸ“œ</div><h3 id="modal-title" class="text-xl font-bold mb-3 text-stone-900 tracking-widest">æ¨™é¡Œ</h3><div id="modal-msg" class="text-stone-600 mb-8 text-base leading-relaxed whitespace-pre-wrap">å…§å®¹</div><div id="modal-actions" class="flex justify-center gap-2"></div></div></div>
    
    <!-- å›é¦–é ç¢ºèª -->
    <div id="modal-home-confirm" class="modal-mask"><div class="modal-body"><div class="text-5xl mb-4">ğŸ </div><h3 class="text-xl font-bold mb-3">æš«åœä¿®ç¯‰</h3><p class="text-stone-600 mb-6">è¦å›åˆ°é¦–é å—ï¼Ÿ<br>ç›®å‰çš„é€²åº¦å°‡ä¸æœƒä¿å­˜ã€‚</p><div class="flex gap-3"><button class="flex-1 btn-secondary" onclick="document.getElementById('modal-home-confirm').style.display='none'">ç¹¼çºŒéŠç©</button><button class="flex-1 btn-primary" onclick="App.confirmBackToHome()">å›åˆ°é¦–é </button></div></div></div>

    <!-- æ¯æ—¥ä»»å‹™ -->
    <div id="modal-mission" class="modal-mask"><div class="modal-body" style="max-width: 360px;"><span class="close-modal" onclick="document.getElementById('modal-mission').style.display='none'">Ã—</span><h3 class="text-xl font-bold mb-1 text-center text-stone-900 tracking-widest">æ¯æ—¥ä»»å‹™</h3><p class="text-center text-xs text-stone-500 mb-4">ä»Šæ—¥å·²å®Œæˆæ–°é—œå¡ï¼š<span id="mission-progress-text" class="text-red-600 font-bold">0</span> é—œ</p><div class="flex flex-col gap-3" id="mission-list"></div></div></div>

    <!-- å•†åŸ -->
    <div id="shop-modal" class="modal-mask"><div class="modal-body"><span class="close-modal" onclick="document.getElementById('shop-modal').style.display='none'">Ã—</span><h3 class="text-xl font-bold mb-2 text-center text-stone-900 tracking-widest">å¹¸é‹è½‰ç›¤</h3><div class="bg-stone-100 p-2 rounded mb-4 flex justify-between items-center"><span>æŒæœ‰å…ƒå¯¶ï¼š</span><span class="text-xl font-bold text-amber-600">ğŸª™ <span id="shop-coin-text">0</span></span></div><div class="wheel-container mb-4 relative mx-auto" style="width:200px; height:200px;"><div id="wheel" class="wheel"><div class="wheel-text">?</div></div><div class="wheel-pointer">â–¼</div></div><button id="btn-spin" class="btn-primary w-full mb-4" onclick="App.spinWheel()">èŠ±è²» 50 ğŸª™ æŠ½ç</button><div class="border-t border-dashed border-stone-300 my-3"></div><div class="flex flex-col gap-2"><div class="flex justify-between items-center text-sm"><span>æ¯æ—¥è£œçµ¦ (ğŸ•¯ï¸+1)</span><button id="shop-btn-daily" class="bg-stone-800 text-white px-3 py-1 rounded" onclick="App.dailyCheckIn()">é ˜å–</button></div><div class="flex justify-between items-center text-sm"><span>çœ‹å»£å‘Š (ğŸ•¯ï¸+1)</span><button id="shop-btn-watch-ad" class="bg-stone-800 text-white px-3 py-1 rounded" onclick="App.watchAd()">æ’­æ”¾</button></div></div></div></div>

    <!-- NPC -->
    <div id="npc-modal" class="npc-container" style="display:none;"><div class="npc-wrapper"><div class="npc-image-box"><img src="images/npc.png" alt="NPC" class="npc-img" onerror="this.style.display='none';this.parentElement.innerHTML='ğŸ‘´'"></div><div class="npc-dialog-box"><div class="npc-name">å®ˆè­·è€…</div><p id="npc-text" class="npc-text">...</p><button id="npc-btn" class="npc-action-btn">å¥½</button></div></div></div>

    <div id="tutorial-mask" style="display:none;"></div>
    
    <!-- Loading -->
    <div id="ad-loading-overlay" style="display:none;">
        <div class="ad-spinner"></div>
        <p class="ad-loading-text">å»£å‘Šæº–å‚™ä¸­...</p>
    </div>
    
    <script src="js/data_core.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
