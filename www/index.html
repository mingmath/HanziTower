<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>字塔 Hanzi Tower</title>
    
    <!-- Google H5 Games Ads SDK -->
    <script async
        data-ad-client="ca-pub-4655366880404164"
        data-ad-type="h5-games"
        data-ad-break-test="on"
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
    </script>
    
    <script>
        window.adsbygoogle = window.adsbygoogle || [];
        var adBreak = function(o) {adsbygoogle.push(o);}
        adsbygoogle.push({ sound: 'on', preloadAdBreaks: 'on' });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .custom-icon { width: 24px; height: 24px; object-fit: contain; display: inline-block; vertical-align: middle; }
    </style>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div id="error-console" style="display:none; position:fixed; bottom:0; left:0; background:red; color:white; padding:10px; z-index:9999;"></div>
    
    <!-- 音樂元件 -->
    <audio id="bg-music" loop></audio>

    <!-- 特效層 (彩帶) -->
    <div id="confetti-container"></div>

    <!-- 頂部導航 -->
    <div class="top-bar">
        <!-- 等級顯示 -->
        <div class="level-badge" id="level-display">
            <span class="level-icon">🏅</span>
            <div class="level-info">
                <span id="lvl-num">1等</span>
                <span id="lvl-progress" class="text-xs">0/27</span>
            </div>
        </div>

        <div class="top-actions">
            <button class="icon-btn" id="btn-top-home" title="首頁"><span class="text-xl">🏠</span></button>
            <button class="icon-btn" id="btn-top-mission" title="每日任務">
                <span class="text-xl">📜</span>
                <div id="mission-dot" class="red-dot" style="display:none;"></div>
            </button>
            <button class="icon-btn" id="btn-top-notebook" title="筆記">
                <img src="images/note.png" alt="筆記" class="custom-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','📖')">
            </button>
            <button class="icon-btn" id="btn-top-shop" title="商城">
                <img src="images/shop.png" alt="商城" class="custom-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','🛒')">
            </button>
        </div>
    </div>

    <!-- 首頁 -->
    <div id="view-home" class="view active" style="justify-content: center;">
        <div class="flex flex-col items-center mb-12">
            <img src="images/logo.png" alt="字塔" class="w-48 sm:w-48 mb-6 object-contain drop-shadow-md" onerror="this.style.display='none';this.insertAdjacentHTML('afterend','<h1 class=\'text-5xl font-black mb-4\'>字塔</h1>')">
        </div>
        <div class="flex flex-col gap-5 w-full max-w-xs px-6">
            <button id="btn-start" class="btn-primary text-xl py-4">開始遊戲</button>
            <button id="btn-daily" class="btn-secondary text-lg">📅 簽到領蠟燭</button>
            <button id="btn-notebook" class="btn-secondary text-lg bg-stone-100">📖 詞語筆記</button>
        </div>
        <p class="absolute bottom-5 text-stone-400 text-xs">Ver 5.1 Final Fix</p>
    </div>

    <!-- 關卡選單 -->
    <div id="view-levels" class="view">
        <div class="w-full max-w-md flex flex-col items-center mb-6">
            <div class="flex justify-between items-center w-full mb-4">
                <button id="btn-back-home" class="text-stone-500 font-bold hover:text-black">◀ 返回</button>
                <h2 class="text-2xl font-bold text-stone-800 tracking-widest">選擇關卡</h2>
                <div style="width: 50px;"></div>
            </div>
            <div class="realm-selector">
                <div id="prev-realm" class="realm-nav-btn" onclick="App.changeRealm(-1)">◀</div>
                <div class="realm-info"><div class="realm-label">CURRENT REALM</div><div id="realm-title" class="realm-name">第一國度</div></div>
                <div id="next-realm" class="realm-nav-btn" onclick="App.changeRealm(1)">▶</div>
            </div>
        </div>
        <div id="level-list-container" class="level-grid"></div>
    </div>

    <!-- 遊戲主畫面 -->
    <div id="view-game" class="view">
        <div class="game-top-section w-full max-w-2xl flex flex-col items-center flex-grow">
            <div class="w-full flex justify-between items-center mb-2 px-2">
                <!-- 房子按鈕功能由 Top Bar 取代，這裡留空保持排版 -->
                <div style="width: 30px;"></div>
                
                <div class="scroll-header">
                    <div class="scroll-stick left"></div>
                    <div class="scroll-content" id="current-level-title">第一關</div>
                    <div class="scroll-stick right"></div>
                </div>
                
                <div style="width: 30px;"></div>
            </div>
            
            <div id="hint-result-area"></div>
            <div id="answer-grid" class="towers-wrapper"></div>
        </div>
        
        <div class="game-bottom-section w-full max-w-lg">
            <div class="w-full border-t-2 border-stone-300 mb-3"></div>
            <div id="character-pool" class="grid-box"></div>
            
            <div class="flex gap-4 w-full mt-4 mb-2 px-4">
                <button id="btn-hint-bottom" class="flex-1 bg-amber-500 text-white py-3 rounded font-bold shadow-md flex justify-center items-center gap-2 text-lg active:scale-95 transition-transform">
                    <span>💡</span> 提示 (<span id="btn-hint-count">0</span>)
                </button>
                
                <button id="btn-check" class="flex-1 btn-primary text-lg shadow-md">修築完成</button>
            </div>
        </div>
    </div>

    <!-- 筆記本 -->
    <div id="view-notebook" class="view">
        <div class="w-full max-w-md flex items-center justify-between mb-4">
            <button id="btn-back-note" class="text-stone-500 font-bold">◀ 返回</button>
            <h2 class="text-xl font-bold text-stone-800 tracking-widest">修築筆記</h2>
            <div></div>
        </div>
        <div id="notebook-list" class="w-full max-w-md flex flex-col gap-3 pb-10"></div>
    </div>

    <!-- Modals -->
    <div id="modal" class="modal-mask"><div id="modal-content" class="modal-body"><div id="modal-icon" class="text-5xl mb-4 text-stone-700">📜</div><h3 id="modal-title" class="text-xl font-bold mb-3 text-stone-900 tracking-widest">標題</h3><div id="modal-msg" class="text-stone-600 mb-8 text-base leading-relaxed whitespace-pre-wrap">內容</div><div id="modal-actions" class="flex justify-center gap-2"></div></div></div>
    
    <!-- 回首頁確認 -->
    <div id="modal-home-confirm" class="modal-mask"><div class="modal-body"><div class="text-5xl mb-4">🏠</div><h3 class="text-xl font-bold mb-3">暫停修築</h3><p class="text-stone-600 mb-6">要回到首頁嗎？<br>目前的進度將不會保存。</p><div class="flex gap-3"><button class="flex-1 btn-secondary" onclick="document.getElementById('modal-home-confirm').style.display='none'">繼續遊玩</button><button class="flex-1 btn-primary" onclick="App.confirmBackToHome()">回到首頁</button></div></div></div>

    <!-- 每日任務 -->
    <div id="modal-mission" class="modal-mask"><div class="modal-body" style="max-width: 360px;"><span class="close-modal" onclick="document.getElementById('modal-mission').style.display='none'">×</span><h3 class="text-xl font-bold mb-1 text-center text-stone-900 tracking-widest">每日任務</h3><p class="text-center text-xs text-stone-500 mb-4">今日已完成新關卡：<span id="mission-progress-text" class="text-red-600 font-bold">0</span> 關</p><div class="flex flex-col gap-3" id="mission-list"></div></div></div>

    <!-- 商城 -->
    <div id="shop-modal" class="modal-mask"><div class="modal-body"><span class="close-modal" onclick="document.getElementById('shop-modal').style.display='none'">×</span><h3 class="text-xl font-bold mb-2 text-center text-stone-900 tracking-widest">幸運轉盤</h3><div class="bg-stone-100 p-2 rounded mb-4 flex justify-between items-center"><span>持有元寶：</span><span class="text-xl font-bold text-amber-600">🪙 <span id="shop-coin-text">0</span></span></div><div class="wheel-container mb-4 relative mx-auto" style="width:200px; height:200px;"><div id="wheel" class="wheel"><div class="wheel-text">?</div></div><div class="wheel-pointer">▼</div></div><button id="btn-spin" class="btn-primary w-full mb-4" onclick="App.spinWheel()">花費 50 🪙 抽獎</button><div class="border-t border-dashed border-stone-300 my-3"></div><div class="flex flex-col gap-2"><div class="flex justify-between items-center text-sm"><span>每日補給 (🕯️+1)</span><button id="shop-btn-daily" class="bg-stone-800 text-white px-3 py-1 rounded" onclick="App.dailyCheckIn()">領取</button></div><div class="flex justify-between items-center text-sm"><span>看廣告 (🕯️+1)</span><button id="shop-btn-watch-ad" class="bg-stone-800 text-white px-3 py-1 rounded" onclick="App.watchAd()">播放</button></div></div></div></div>

    <!-- NPC -->
    <div id="npc-modal" class="npc-container" style="display:none;"><div class="npc-wrapper"><div class="npc-image-box"><img src="images/npc.png" alt="NPC" class="npc-img" onerror="this.style.display='none';this.parentElement.innerHTML='👴'"></div><div class="npc-dialog-box"><div class="npc-name">守護者</div><p id="npc-text" class="npc-text">...</p><button id="npc-btn" class="npc-action-btn">好</button></div></div></div>

    <div id="tutorial-mask" style="display:none;"></div>
    
    <!-- Loading -->
    <div id="ad-loading-overlay" style="display:none;">
        <div class="ad-spinner"></div>
        <p class="ad-loading-text">廣告準備中...</p>
    </div>
    
    <script src="js/data_core.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
