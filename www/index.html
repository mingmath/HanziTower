<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å­—å¡” Hanzi Tower</title>
    
    <!-- Google H5 Games Ads SDK -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4655366880404164"
     crossorigin="anonymous"
     data-ad-frequency-hint="30s"></script>
    
    <!-- å»£å‘Šåƒæ•¸è¨­å®š -->
    <script>
        window.adsbygoogle = window.adsbygoogle || [];
        var adBreak = function(o) {adsbygoogle.push(o);}
        adsbygoogle.push({
            sound: 'on', 
            preloadAdBreaks: 'on', 
        });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .custom-icon { width: 24px; height: 24px; object-fit: contain; display: inline-block; vertical-align: middle; }
        .res-icon { width: 20px; height: 20px; object-fit: contain; margin-right: 4px; vertical-align: text-bottom; }
        
        /* é€šç”¨æ¨£å¼èˆ‡ç‰¹æ•ˆ */
        #tutorial-mask { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.7); z-index: 2000; display: none; pointer-events: auto; }
        .tutorial-highlight { position: relative !important; z-index: 4000 !important; box-shadow: 0 0 20px 10px rgba(255, 255, 255, 0.8) !important; transform: scale(1.1) translateZ(0); transition: all 0.3s ease; pointer-events: auto !important; }
        .char-tile.tutorial-highlight, .drop-zone.tutorial-highlight { background-color: white !important; border: 2px solid #ef4444 !important; }
        .tower-clear-btn { position: absolute; top: -12px; right: -12px; width: 28px; height: 28px; background-color: #ef4444; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 18px; font-weight: bold; line-height: 1; z-index: 150; box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 2px solid white; transition: transform 0.2s; }
        .tower-clear-btn:active { transform: scale(0.9); background-color: #dc2626; }
        .tower-clear-btn.tutorial-highlight { position: absolute !important; top: -12px !important; right: -12px !important; background-color: #ef4444 !important; color: white !important; box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.8) !important; transform: scale(1.2) translateZ(0) !important; z-index: 4000 !important; }
        .heart-btn.tutorial-highlight { background-color: transparent !important; box-shadow: 0 0 15px 5px rgba(255, 255, 0, 0.8) !important; transform: scale(1.5) !important; z-index: 4000 !important; }
        #hint-result-area { position: absolute; top: 100%; right: 0; margin-top: 5px; font-size: 0.9rem; color: #b91c1c; font-weight: bold; white-space: nowrap; pointer-events: none; text-shadow: 0 0 2px white; }
        .red-circle-mark { position: relative; border: 4px solid #ef4444 !important; border-radius: 8px !important; box-shadow: 0 0 15px rgba(239, 68, 68, 0.6); z-index: 1900 !important; background-color: #fff1f2 !important; }
        .hint-float-label { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); background: #b91c1c; color: white; padding: 6px 10px; border-radius: 6px; font-size: 14px; font-weight: bold; white-space: nowrap; z-index: 2005; box-shadow: 0 4px 6px rgba(0,0,0,0.2); animation: bounce 1s infinite alternate; }
        .hint-float-label::after { content: ''; position: absolute; bottom: -6px; left: 50%; margin-left: -6px; border-width: 6px 6px 0; border-style: solid; border-color: #b91c1c transparent transparent transparent; }
        @keyframes bounce { from{transform:translate(-50%, 0);} to{transform:translate(-50%, -5px);} }
    </style>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div id="error-console" style="display:none; position:fixed; bottom:0; left:0; background:red; color:white; padding:10px; z-index:9999;"></div>
    

    <!-- é ‚éƒ¨å°èˆª -->
    <div class="top-bar">
        <div class="top-left">
            <div class="res-badge bg-stone-100"><span>ğŸ†</span> <span id="level-text">Lv.1</span></div>
        </div>
        <div class="top-right">
            <!-- ç­†è¨˜æŒ‰éˆ• -->
            <button class="icon-btn" id="btn-top-notebook" title="ç­†è¨˜">
                <img src="images/note.png" alt="ç­†è¨˜" class="custom-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','ğŸ“–')">
            </button>
            
            <!-- å•†åŸ/è£œçµ¦ç«™æŒ‰éˆ• -->
            <button class="icon-btn" id="btn-shop" title="è³‡æºè£œçµ¦">
                <img src="images/shop.png" alt="å•†åŸ" class="custom-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','ğŸ')">
            </button>
            
            <!-- é‡‘å¹£æ¬„ä½ -->
            <div class="res-badge">
                <img src="images/coin.png" alt="é‡‘å¹£" class="res-icon" onerror="this.style.display='none';this.parentElement.insertAdjacentHTML('beforeend','ğŸª™')">
                <span id="coin-text">0</span>
            </div>
            
            <!-- è Ÿç‡­æ¬„ä½ (æ•´åˆå»£å‘ŠæŒ‰éˆ•) -->
            <div class="res-badge"><span>ğŸ•¯ï¸</span> <span id="key-text">0</span><button id="btn-ad" class="ad-btn">ğŸ“º</button></div>
        </div>
    </div>

    <!-- é¦–é  -->
    <div id="view-home" class="view active" style="justify-content: center;">
        <div class="flex flex-col items-center mb-12">
            <img src="images/logo.png" alt="å­—å¡”" class="w-48 sm:w-48 mb-6 object-contain drop-shadow-md" onerror="this.style.display='none';this.insertAdjacentHTML('afterend','<h1 class=\'text-5xl font-black mb-4\'>å­—å¡”</h1>')">
        </div>
        <div class="flex flex-col gap-5 w-full max-w-xs px-6">
            <button id="btn-start" class="btn-primary text-xl py-4">é–‹å§‹éŠæˆ²</button>
            <button id="btn-daily" class="btn-secondary text-lg">ğŸ“… ç°½åˆ°é ˜è Ÿç‡­</button>
            <button id="btn-notebook" class="btn-secondary text-lg bg-stone-100">ğŸ“– è©èªç­†è¨˜</button>
        </div>
        <p class="absolute bottom-5 text-stone-400 text-xs">Ver 4.8 Ad-Support Update</p>
    </div>

    <!-- é—œå¡é¸å–® -->
    <div id="view-levels" class="view">
        <div class="w-full max-w-md flex flex-col items-center mb-6">
            <div class="flex justify-between items-center w-full mb-4">
                <button id="btn-back-home" class="text-stone-500 font-bold hover:text-black">â—€ è¿”å›</button>
                <h2 class="text-2xl font-bold text-stone-800 tracking-widest">é¸æ“‡é—œå¡</h2>
                <div style="width: 50px;"></div>
            </div>
            <div class="realm-selector">
                <div id="prev-realm" class="realm-nav-btn" onclick="App.changeRealm(-1)">â—€</div>
                <div class="realm-info"><div class="realm-label">CURRENT REALM</div><div id="realm-title" class="realm-name">ç¬¬ä¸€åœ‹åº¦</div></div>
                <div id="next-realm" class="realm-nav-btn" onclick="App.changeRealm(1)">â–¶</div>
            </div>
        </div>
        <div id="level-list-container" class="level-grid"></div>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="view-game" class="view">
        <div class="game-top-section w-full max-w-2xl flex flex-col items-center flex-grow">
            <div class="w-full flex justify-between items-center mb-2 px-2">
                <button id="btn-stop-game" class="text-stone-400 text-3xl hover:text-stone-600">Ã—</button>
                <div class="scroll-header">
                    <div class="scroll-stick left"></div>
                    <div class="scroll-content" id="current-level-title">ç¬¬ä¸€é—œ</div>
                    <div class="scroll-stick right"></div>
                </div>
                <div class="flex flex-col items-end relative">
                    <button id="btn-hint" class="bg-stone-100 text-stone-700 px-3 py-1 rounded border border-stone-300 font-bold flex items-center gap-1 active:bg-stone-200 text-sm">
                        <span>ğŸ•¯ï¸</span> æç¤º (<span id="hint-count">0</span>)
                    </button>
                    <div id="hint-result-area"></div>
                </div>
            </div>
            <div id="answer-grid" class="towers-wrapper"></div>
        </div>
        <div class="game-bottom-section w-full max-w-lg">
            <div class="w-full border-t-2 border-stone-300 mb-3"></div>
            <div id="character-pool" class="grid-box"></div>
            <div class="flex gap-4 w-full mt-4 mb-2 px-4">
                <button id="btn-reset" class="flex-1 bg-stone-400 text-white py-3 rounded font-bold shadow-md">é‡ç½®</button>
                <button id="btn-check" class="flex-1 btn-primary text-lg shadow-md">ä¿®ç¯‰å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- ç­†è¨˜æœ¬ -->
    <div id="view-notebook" class="view">
        <div class="w-full max-w-md flex items-center justify-between mb-4">
            <button id="btn-back-note" class="text-stone-500 font-bold">â—€ è¿”å›</button>
            <h2 class="text-xl font-bold text-stone-800 tracking-widest">ä¿®ç¯‰ç­†è¨˜</h2>
            <div></div>
        </div>
        <div id="notebook-list" class="w-full max-w-md flex flex-col gap-3 pb-10"></div>
    </div>

    <!-- é€šç”¨ Modal -->
    <div id="modal" class="modal-mask"><div class="modal-body"><div id="modal-icon" class="text-5xl mb-4 text-stone-700">ğŸ“œ</div><h3 id="modal-title" class="text-xl font-bold mb-3 text-stone-900 tracking-widest">æ¨™é¡Œ</h3><p id="modal-msg" class="text-stone-600 mb-8 text-base leading-relaxed whitespace-pre-wrap">å…§å®¹</p><div id="modal-actions" class="flex justify-center gap-2"></div></div></div>
    
    <!-- è³‡æºè£œçµ¦ç«™ Modal -->
    <div id="shop-modal" class="modal-mask">
        <div class="modal-body">
            <span class="close-modal" onclick="document.getElementById('shop-modal').style.display='none'">Ã—</span>
            <h3 class="text-xl font-bold mb-4 text-center text-stone-900 tracking-widest">è³‡æºè£œçµ¦</h3>
            
            <div class="flex flex-col gap-3 mb-4">
                <!-- æ¯æ—¥ç°½åˆ°å€å¡Š -->
                <div class="border p-3 rounded flex justify-between items-center bg-stone-50">
                    <div class="text-left">
                        <div class="font-bold text-stone-800">æ¯æ—¥è£œçµ¦</div>
                        <div class="text-xs text-stone-500">æ¯å¤©ä¸€æ¬¡</div>
                    </div>
                    <div class="text-xl font-bold text-amber-600">ğŸ•¯ï¸ +1</div>
                    <button id="shop-btn-daily" class="bg-stone-800 text-white px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed" onclick="App.dailyCheckIn()">é ˜å–</button>
                </div>
    
                <!-- å»£å‘Šç²å–å€å¡Š -->
                <div class="border p-3 rounded flex justify-between items-center bg-stone-50">
                    <div class="text-left">
                        <div class="font-bold text-stone-800">çœ‹å»£å‘Š</div>
                        <div class="text-xs text-stone-500">æ”¯æŒä½œè€…</div>
                    </div>
                    <div class="text-xl font-bold text-amber-600">ğŸ•¯ï¸ +1</div>
                    <button class="bg-stone-800 text-white px-3 py-1 rounded text-sm" onclick="App.watchAd()">æ’­æ”¾</button>
                </div>
            </div>
            <p class="text-xs text-stone-400">ç›®å‰åƒ…é–‹æ”¾å…è²»ç²å–é€”å¾‘</p>
        </div>
    </div>

    <!-- NPC Modal -->
    <div id="npc-modal" class="npc-container" style="display:none;">
        <div class="npc-wrapper">
            <div class="npc-image-box">
                <img src="images/npc.png" alt="NPC" class="npc-img" onerror="this.style.display='none';this.parentElement.innerHTML='ğŸ‘´'">
            </div>
            <div class="npc-dialog-box">
                <div class="npc-name">å®ˆè­·è€…</div>
                <p id="npc-text" class="npc-text">...</p>
                <button id="npc-btn" class="npc-action-btn">å¥½</button>
            </div>
        </div>
    </div>

    <div id="tutorial-mask" style="display:none;"></div>
    
    <!-- æ ¸å¿ƒé‚è¼¯ (è«‹æ³¨æ„é †åº) -->
    <script src="js/data_core.js"></script>
    <script src="js/app.js"></script>
<!-- å»£å‘Š Loading é®ç½© -->
    <div id="ad-loading-overlay" style="display:none;">
        <div class="ad-spinner"></div>
        <p class="ad-loading-text">å»£å‘Šæº–å‚™ä¸­...</p>
    </div>

    <!-- åŸæœ¬çš„ script æ¨™ç±¤ä¿æŒåœ¨ä¸‹é¢ -->
    <script src="js/data_core.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

